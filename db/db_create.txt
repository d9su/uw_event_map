delimiter $$

CREATE DATABASE `compuzz` /*!40100 DEFAULT CHARACTER SET latin1 */$$


delimiter $$

CREATE TABLE `event_info` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(45) NOT NULL,
  `type` int(11) NOT NULL,
  `start` datetime NOT NULL,
  `end` datetime NOT NULL,
  `desc` text NOT NULL,
  `created_by` varchar(45) NOT NULL,
  `created_at` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_event_info_1` (`type`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=latin1$$

CREATE
DEFINER=`compuzz`@`localhost`
TRIGGER `compuzz`.`event_info_creation`
BEFORE INSERT ON `compuzz`.`event_info`
FOR EACH ROW
SET NEW.created_at = IFNULL(NEW.created_at, NOW())
$$


delimiter $$

CREATE TABLE `event_tag` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `tag_name` varchar(45) NOT NULL,
  `tag_desc` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=latin1$$


delimiter $$

CREATE TABLE `event_tag_link` (
  `event_info_id` int(11) NOT NULL,
  `event_tag_id` int(11) NOT NULL,
  PRIMARY KEY (`event_info_id`,`event_tag_id`),
  KEY `fk_event_tag_link_event_info` (`event_info_id`),
  KEY `fk_event_tag_link_event_tag` (`event_tag_id`),
  CONSTRAINT `fk_event_tag_link_event_info` FOREIGN KEY (`event_info_id`) REFERENCES `event_info` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_event_tag_link_event_tag` FOREIGN KEY (`event_tag_id`) REFERENCES `event_tag` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=latin1$$


delimiter $$

CREATE TABLE `event_type` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type_name` varchar(45) NOT NULL,
  `type_longname` varchar(45) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=latin1$$


delimiter $$

CREATE TABLE `user` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_name` varchar(45) NOT NULL,
  `email` varchar(256) NOT NULL,
  `hash` varchar(256) NOT NULL,
  `salt` varchar(256) NOT NULL,
  `register_at` datetime NOT NULL,
  `last_visit_at` datetime NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `user_name_UNIQUE` (`user_name`),
  UNIQUE KEY `email_UNIQUE` (`email`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=latin1$$



